"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _actions=require("../../tools/actions"),Action=_interopRequireWildcard(_actions),_request=require("../_utils/request"),request=_interopRequireWildcard(_request),_const=require("../_utils/const");Component({properties:{token:{type:String,value:null},verifyType:{type:Number,value:null},retryTimes:{type:Number}},attached:function(){this.setData({containerClass:this.data.verifyType===_const.VERIFY_TYPES.all?"all":"single"})},ready:function(){this.base=this.selectComponent("#base"),wx.occur("enter_photograph")},data:{fileuploaded:!1,containerClass:"",VERIFY_TYPES:_const.VERIFY_TYPES,frontError:null,backError:null,image_frontside:null,image_backside:null,image_id_front:null,image_id_back:null,canvasWidth:300,canvasHeight:225},methods:{onNext:function(){this.triggerEvent("nextstep")},verify:function(){var e=this;wx.occur("ocr_button");var t=this.data,r=t.image_frontside,a=t.image_backside;request.uploadIdCardAndVerify({biz_token:this.data.token,image_frontside_local:r,image_backside_local:a},this.base).then(function(t){e.base.callExitLite(t.result_code)}).catch(function(t){var r=t.frontErrorCode,a=t.backErrorCode,o=e.data.retryTimes-1;e.setData({retryTimes:o}),o<=0&&e.base.callExitLite(t.result_code),t.code>-1?e.setData({frontError:r?(0,_const.getErrorMessageByResultCode)(r):null,backError:a?(0,_const.getErrorMessageByResultCode)(a):null}):e.base.showModal(t.result_code)})},onTakePhoto:function(e){var t=e.currentTarget.dataset.side,r=this;this.data["image_id_"+t]?wx.occur("photograph_"+t+"side_retry"):wx.occur("photograph_"+t+"side"),Action.chooseImage({checkSize:!0}).then(function(e){var a,o=r.data,i=o.fileuploaded;i=o.verifyType!==_const.VERIFY_TYPES.all||r.data["image_"+("front"===t?"back":"front")+"side"],r.setData((a={fileuploaded:i},_defineProperty(a,"image_"+t+"side",e),_defineProperty(a,t+"Error",null),a))}).catch(function(e){e&&e.codeText&&r.base.showModal(e.codeText)})},photographQuit:function(){wx.occur("photograph_quit")}}});